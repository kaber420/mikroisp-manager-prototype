{% extends "base.html" %}

{% block title %}AP Details - µMonitor Pro{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/dashboard-transitions.css">
{% endblock %}

{% block content %}
<!-- Contenido Principal -->
<main class="flex-1 p-6 lg:p-8">
    <div class="flex flex-wrap justify-between items-center gap-4 mb-8">
        <div class="flex items-center gap-4">
            <a href="/aps" title="Volver a APs" class="text-primary hover:opacity-75">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            <h1 id="main-hostname" class="text-4xl font-bold">Loading AP Details...</h1>
        </div>
        <div class="flex items-center gap-4">
            <button id="edit-ap-button" class="flex items-center justify-center h-10 px-4 text-sm font-bold text-white rounded-lg bg-primary hover:bg-primary-hover"><span class="material-symbols-outlined mr-2">edit</span><span>Edit</span></button>
            <button id="delete-ap-button" class="flex items-center justify-center h-10 px-4 text-sm font-bold text-white rounded-lg bg-danger hover:bg-red-700"><span class="material-symbols-outlined mr-2">delete</span><span>Delete</span></button>
        </div>
    </div>
    
    <!-- ID AÑADIDO PARA LA ANIMACIÓN -->
    <div id="device-info-card" class="bg-surface-1 rounded-lg border border-border-color p-6 mb-8">
        <h2 class="text-xl font-bold mb-4">Device Information & Performance</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-4 text-sm">
            <div><p class="text-text-secondary">Host / IP</p><p id="detail-host" class="font-semibold font-mono">--</p></div><div><p class="text-text-secondary">Status</p><div id="detail-status">--</div></div>
            <div><p class="text-text-secondary">Model</p><p id="detail-model" class="font-semibold">--</p></div><div><p class="text-text-secondary">SSID</p><p id="detail-essid" class="font-semibold">--</p></div>
            <div><p class="text-text-secondary">MAC Address</p><p id="detail-mac" class="font-semibold font-mono">--</p></div><div><p class="text-text-secondary">Firmware</p><p id="detail-firmware" class="font-semibold">--</p></div>
            <div><p class="text-text-secondary">Zone</p><p id="detail-zona" class="font-semibold">--</p></div><div><p class="text-text-secondary">GPS (Lat/Lon)</p><p id="detail-gps" class="font-semibold">--</p></div>
            <div><p class="text-text-secondary">Client Count</p><p id="detail-clients" class="font-semibold">--</p></div><div><p class="text-text-secondary">Noise Floor</p><p id="detail-noise" class="font-semibold">--</p></div>
            <div><p class="text-text-secondary">Frequency / Channel</p><p id="detail-frequency" class="font-semibold">--</p></div><div><p class="text-text-secondary">Satellites</p><p id="detail-sats" class="font-semibold">--</p></div>
            <div><p class="text-text-secondary">Airtime (Total/Tx/Rx)</p><p id="detail-airtime" class="font-semibold">--</p></div><div><p class="text-text-secondary">Throughput (DL/UL)</p><p id="detail-throughput" class="font-semibold">--</p></div><div><p class="text-text-secondary">Total Data (DL/UL)</p><p id="detail-total-data" class="font-semibold">--</p></div>
        </div>
    </div>
    
    <!-- ID AÑADIDO PARA LA ANIMACIÓN -->
    <div id="charts-card" class="bg-surface-1 rounded-lg border border-border-color p-6 mb-8">
        <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
            <h2 class="text-xl font-bold">Performance History</h2>
            <div class="flex items-center gap-4">
                <div id="period-selector" class="flex gap-1 bg-surface-2 p-1 rounded-lg">
                    <button data-period="24h" class="chart-button px-3 py-1 text-sm font-medium rounded-md active">24h</button>
                    <button data-period="7d" class="chart-button px-3 py-1 text-sm font-medium rounded-md text-text-secondary hover:bg-surface-1">7d</button>
                    <button data-period="30d" class="chart-button px-3 py-1 text-sm font-medium rounded-md text-text-secondary hover:bg-surface-1">30d</button>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-sm font-medium text-text-secondary">Live Mode</span>
                    <label for="auto-refresh-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="auto-refresh-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-surface-2 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                    <span id="refresh-timer" class="text-sm font-mono text-primary w-12 text-center"></span>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 pt-4">
            <div class="lg:col-span-1"><h3 class="font-semibold mb-2 text-center text-text-secondary">Client Count</h3><canvas id="clientsChart"></canvas></div>
            <div class="lg:col-span-1"><h3 class="font-semibold mb-2 text-center text-text-secondary">Airtime Usage (%)</h3><canvas id="airtimeChart"></canvas></div>
            <div class="lg:col-span-1"><h3 class="font-semibold mb-2 text-center text-text-secondary">Throughput (kbps)</h3><canvas id="throughputChart"></canvas></div>
        </div>
    </div>
    
    <!-- ID AÑADIDO PARA LA ANIMACIÓN -->
    <div id="client-list-section">
        <div class="mb-8"><h2 class="text-2xl font-bold">Connected Clients</h2></div>
        <div id="client-list" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
    </div>
</main>

<div id="edit-ap-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 hidden">
    <div class="bg-surface-1 rounded-lg shadow-xl w-full max-w-2xl border border-border-color">
        <form id="edit-ap-form">
            <div class="p-6 border-b border-border-color"><h3 class="text-2xl font-bold">Edit Access Point</h3></div>
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label for="edit-host" class="block text-sm font-medium mb-1">Host (IP Address)</label><input type="text" id="edit-host" name="host" readonly class="w-full bg-background border border-border-color rounded-md p-2 text-text-secondary cursor-not-allowed"></div>
                    <div><label for="edit-zona_id" class="block text-sm font-medium mb-1">Zone</label><select id="edit-zona_id" name="zona_id" required class="w-full bg-background border border-border-color rounded-md p-2 focus:ring-primary focus:border-primary"></select></div>
                    <div><label for="edit-monitor_interval" class="block text-sm font-medium mb-1">Live Interval (s)</label><input type="number" id="edit-monitor_interval" name="monitor_interval" placeholder="Default" class="w-full bg-background border border-border-color rounded-md p-2 focus:ring-primary focus:border-primary"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label for="edit-username" class="block text-sm font-medium mb-1">Username</label><input type="text" id="edit-username" name="username" required class="w-full bg-background border border-border-color rounded-md p-2 focus:ring-primary focus:border-primary"></div>
                    <div><label for="edit-password" class="block text-sm font-medium mb-1">New Password</label><input type="password" id="edit-password" name="password" placeholder="Leave blank to keep current" class="w-full bg-background border border-border-color rounded-md p-2 focus:ring-primary focus:border-primary"></div>
                </div>
                <div id="edit-form-error" class="text-danger text-sm hidden"></div>
            </div>
            <div class="p-6 bg-surface-2 rounded-b-lg flex justify-end gap-4">
                <button type="button" id="edit-cancel-button" class="px-4 py-2 rounded-md text-sm font-semibold hover:bg-surface-1">Cancel</button>
                <button type="submit" class="px-4 py-2 rounded-md text-sm font-semibold text-white bg-primary hover:bg-primary-hover">Save Changes</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script src="/static/js/ap_details.js" defer></script>
{% endblock %}